# 关于DNS 和 CDN的基本原理

## DNS

DNS (Domain Name Server) 域名解析服务，的作用只有一点，那就是将 域名 例如 www.baidu.com -> 183.232.231.174 这样的IP地址，让计算机知道具体的访问的路径

过程如下：

1. 浏览器首先查找本地文件 hosts 是否有对应的域名映射到具体的IP地址，如果有那么直接那本地的域名IP
2. 如果浏览器挂了代理服务器（例如whistle、fiddler）那么代理服务器也可能会根据代理服务的映射直接将代理配置的IP返回
3. 如果没有挂代理服务器且本地没有域名缓存，这时候才会真正的请求本地域名服务器（LDNS  Local DNS）来解析这个域名，这台服务器一般在你的城市的某个角落，距离你不会很远，并且这台服务器的性能都很好，一般都会缓存域名解析结果，大约80%的域名解析到这里就完成了。
4. 如果还是没有找到具体的域名映射，那么请求就会跳转到 Root Server 根服务器进行解析，根服务器会返回给 LDNS 所查询域的主域名服务器（gTLD Server，国际顶尖域名服务器，如.com .cn .org等）一个地址，然后在去这个地址的服务器去找
5. 主域名服务器找到之后将域名映射返回给 LDNS， LDNS 将域名映射返回给用户

## CDN

CDN （content delivery network） 本质上是资源网络集群或者资源服务器，
它能够将资源不断分发到各个节点网络， 当用户访问某个节点的时候，CDN 的距离用户当前网络节点最近的服务器节点，快速返回资源

CDN的步骤如下

1. 用户点击某个资源的URL, 本地DNS服务器进行解析，解析完成后，会将域名的最终解析权交给CNAME指向最近的 CDN 专用 DNS服务器
2. CDN 返回给用户 CDN 负载均衡的IP
3. 用户根据url 请求CDN 负载均衡服务器的IP
4. 负载均衡服务器，会根据用户所在的地址寻找最近的资源服务器，同时还需要判断用户请求的资源在那一台服务器，还有服务器的负载能力等都需要考虑
5. 经过一些列计算后，负载均衡服务器会返回一个缓存资源服务器的IP地址给用户
6. 用户根据该IP 对该缓存资源服务器进行请求访问，如果这台服务器没有用户所需的资源，但是负载均衡服务器依然将这台服务器分配给了用户，那么此时就会向这台资源服务器的上一级查找缓存资源，直到资源的源服务为止以保证最终将资源交给了用户